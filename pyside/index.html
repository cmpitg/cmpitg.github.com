<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PySide Idioms</title>
    <meta name="author" content="Ha-Duong Nguyen" />
    <meta name="description" content="thoughts & rants on tech & language, by cmpitg" />
    <link rel="canonical" href="http://reference-error.org//pyside/" />
    <!-- <link href="//fonts.googleapis.com/css?family=Nunito:400,700,300|Varela+Round" rel="stylesheet" type="text/css"> -->
    <link href="//fonts.googleapis.com/css?family=Alegreya+Sans|Ubuntu+Mono" rel="stylesheet">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="alternate" type="application/rss+xml" title="Reference Error" href="/atom.xml" />
    <link rel="stylesheet" href="/css/site.css">
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
        ga('create', ', 'auto');
        ga('send', 'pageview');
    </script>
  </head>
  <body>
    <section>
      <header class="navigation">
        <div id="header-title">
          <a href="/" class="logo" title="Reference Error">
            Reference Error
      </a>
        </div>
        <div id="social-links-header">
          <a title="cmpitg @ github" href="https://github.com/cmpitg"><i class="fa fa-github-square"></i></a>
          <a title="cmpitg @ linkedin" href="https://fi.linkedin.com/in/cmpitg"><i class="fa fa-linkedin-square"></i></a>
          <a title="cmpitg @ twitter" href="https://twitter.com/cmpitg"><i class="fa fa-twitter-square"></i></a>
        </div>
        <nav>
          <ul>
            <li><a href="/logs">logs</a></li>
            <li><a href="/writing">writing</a></li>
            <li><a href="/talks">talks</a></li>
            <li><a href="/about">about</a></li>
            <li class="no-bullet"><a href="/atom.xml">rss</a></li>
          </ul>
        </nav>
      </header>
      <article>
        <h1 class="title">
          PySide Idioms
  </h1>
        <p class="subtitle">
          <span>
            Series:
          
            
              <a href="/#python">python</a>,
            
          
            
              <a href="/#guide">guide</a>,
            
          
            
              <a href="/#idiom">idiom</a>,
            
          
            
              <a href="/#qt">qt</a>,
            
          
            
              <a href="/#pyside">pyside</a>
          </span>
          <span class="date">
          </span>
        </p>
        <div id="post">
          <p><strong>Supported Python version/implementation</strong>: <a href="http://en.wikipedia.org/wiki/Cpython">CPython</a> <a href="http://en.wikipedia.org/wiki/Py3k#Version_3.0">3+</a></p>
          <h2 id="todo">TODO</h2>
          <ul>
            <li>TOC</li>
          </ul>
          <h2 id="notes">Notes</h2>
          <p>This guide supports Qt on <a href="http://en.wikipedia.org/wiki/Unix-like">*nix</a> platforms.  Specific notes for <a href="http://en.wikipedia.org/wiki/Microsoft_Windows">Microsoft Windows®</a> and other non-*nix platforms are not mentioned.</p>
          <h2 id="idioms">Idioms</h2>
          <h3 id="application">Application</h3>
          <h4 id="retrieving-the-application-instance">Retrieving the application instance</h4>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
</code></pre>
          </div>
          <h3 id="position--border">Position &amp; border</h3>
          <h4 id="removing-widget-margin">Removing widget margin</h4>
          <p>As simple as such:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">aWidget</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="centering-a-widget">Centering a widget</h4>
          <p>Centering a widget can be done by calculating the appropriate geometry for the current widget.  Notes that:</p>
          <ul>
            <li>
              <p>The available geometry (desktop size, minus dock/panel/unplaceable area) could be retrieved by <code class="highlighter-rouge">QApplication.instance().desktop().availableGeometry()</code></p>
            </li>
            <li>
              <p>To set the geometry of a widget, use <code class="highlighter-rouge">widget.setGeometry</code></p>
            </li>
          </ul>
          <p>Example code:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">availGeometry</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">desktop</span><span class="p">()</span><span class="o">.</span><span class="n">availableGeometry</span><span class="p">()</span>
<span class="n">availWidth</span> <span class="o">=</span> <span class="n">availGeometry</span><span class="o">.</span><span class="n">width</span><span class="p">()</span>
<span class="n">availHeight</span> <span class="o">=</span> <span class="n">availGeometry</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>

<span class="n">widget</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">alignedRect</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftToRight</span><span class="p">,</span>
                   <span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">,</span>
                   <span class="n">widget</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
                   <span class="n">availGeometry</span><span class="p">))</span>
</code></pre>
          </div>
          <h3 id="events--shortcuts">Events &amp; shortcuts</h3>
          <h4 id="catching-the-closing-event-of-a-widget">Catching the closing event of a widget</h4>
          <p>The closing event is handled by method <code class="highlighter-rouge">closeEvent(self, event)</code> of a widget.  This technique is often used with a top-level widget (such as a <code class="highlighter-rouge">QMainWindow</code>) to change the way the application is closed.  Call <code class="highlighter-rouge">event.accept()</code> to let Qt do further processing to close the widget and call <code class="highlighter-rouge">event.ignore()</code> to prevent the widget from closing.</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">MyMainWindow</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maybeSave</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeSettings</span><span class="p">()</span>
            <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">ignore</span><span class="p">()</span>
</code></pre>
          </div>
          <h4 id="creating-a-shortcut-associated-with-a-widget">Creating a shortcut associated with a widget</h4>
          <p>This example will create a <code class="highlighter-rouge">pathEntry</code> widget and bind <code class="highlighter-rouge">Ctrl+L</code> to focus the <code class="highlighter-rouge">pathEntry</code>.</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">pathEntry</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
<span class="n">focusShortcut</span> <span class="o">=</span> <span class="n">QShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s">"Ctrl+L"</span><span class="p">),</span> <span class="n">pathEntry</span><span class="p">)</span>
<span class="n">focusShortcut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">pathEntry</span><span class="o">.</span><span class="n">setFocus</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="disabling-right-click-context-menu">Disabling right-click context menu</h4>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">aWidget</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">NoContextMenu</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="re-catching-keyboard-event-using-event-filter">Re-catching keyboard event using event filter</h4>
          <p>A event filter needs to be reimplemented and installed into the current
widget.  Here is how key stroke events work:</p>
          <ul>
            <li>
              <p>Each key press generates a key press event (where <code class="highlighter-rouge">event.type() == QEvent.Type.KeyPress</code>)</p>
            </li>
            <li>
              <p>Each key release generates a key release event (where <code class="highlighter-rouge">event.type() == QEvent.Type.KeyRelease</code>)</p>
            </li>
            <li>
              <p>Key modifiers are represented as integers:</p>
              <p><code class="highlighter-rouge">python
  [
      Qt.NoModifier,
      Qt.ShiftModifier,
      Qt.ControlModifier,
      Qt.AltModifier,
      Qt.MetaModifier,
      Qt.KeypadModifier,
      Qt.GroupSwitchModifier
  ]
 </code></p>
            </li>
            <li>
              <p>Each combination of key modifiers is produced by bit-wise <code class="highlighter-rouge">OR</code>-ing the
integers representing those modifiers.  E.g. if <em>Control</em> and <em>Shift</em> are
pressed, the value of this combination is <code class="highlighter-rouge">Qt.ShiftModifier | Qt.ControlModifier</code>.</p>
            </li>
            <li>A key event includes:
    
              <ul>
                <li>the activated key, retrieving its string representation by using
                  <code class="highlighter-rouge">event.key()</code></li>
                <li>the activated modifiers, is a integer produced by the bit-wise <code class="highlighter-rouge">OR</code>-ing
operation, originally stored in <code class="highlighter-rouge">event.modifiers()</code> and can be retrieved
by testing if a modifier contributes to forming <code class="highlighter-rouge">event.modifiers()</code>.</li>
              </ul>
            </li>
            <li>The event filter needs to return <code class="highlighter-rouge">False</code> if it delegates the event for the
widget itself to further processing and return <code class="highlighter-rouge">True</code> otherwise.</li>
          </ul>
          <p>To sum up, the code might look like:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">SomeWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do some stuff</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eventFilter</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">"""
        This event filter will take care of managing keyboard event of the
        TextEdit.
        """</span>
        <span class="k">if</span> <span class="n">isKeyPressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">mods</span> <span class="o">=</span> <span class="n">getKeymodsFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="c"># Save the modifiers for mouse chord events</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pressedMods</span> <span class="o">=</span> <span class="n">mods</span>

            <span class="c"># Discard events where modifiers and keys are the same</span>
            <span class="k">if</span> <span class="n">isKeymod</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processKey</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">isKeyReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="c"># IMPORTANT: Notes that release is not caught when the window</span>
            <span class="c"># manager interferes</span>

            <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFromEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

            <span class="c">#</span>
            <span class="c"># Used for mouse chords, release the modifier</span>
            <span class="c">#</span>
            <span class="k">if</span> <span class="n">isKeymod</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">and</span> <span class="n">toKeymod</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressedMods</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pressedMods</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">toKeymod</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="c">#</span>
        <span class="c"># Let the default event handler processes the event</span>
        <span class="c">#</span>
        <span class="k">return</span> <span class="bp">False</span>
</code></pre>
          </div>
          <p>See <a href="https://github.com/cmpitg/blutkit">Blutkit</a>’s implementation of
            <a href="https://github.com/cmpitg/blutkit/blob/master/blutkit/gui/textedit.py">TextEdit</a>
            for more info about real-world use.</p>
          <h4 id="catching-mouse-chords">Catching mouse chords</h4>
          <p>Normally, catching simple mouse chords (single click, double click) is very
easy.  Things get complicated when you want to catch multiple-cursors chords
like <code class="highlighter-rouge">Left_Button-Right_Button</code> (hold down the left button, press the right
button, then release both).  <a href="http://acme.cat-v.org">Acme</a> is one of the very
few editors that makes use of multiple-cursors mouse chords really well.  Here
is how we’re gonna try tackling this problem using PySide.</p>
          <p>At any point, we need to know <em>which buttons are pressed</em> and in <strong>which
order</strong>.  Assume that we’re gonna use an array <code class="highlighter-rouge">mousePressedButtons</code> to store
that information.</p>
          <p>The current pressed/released button is retrieved by <code class="highlighter-rouge">event.button()</code>.  Buttons
of a typical 3-button mouse are represented by the following Qt values:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="p">[</span>
    <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span><span class="p">,</span>
    <span class="n">Qt</span><span class="o">.</span><span class="n">RightButton</span>
<span class="p">]</span>
</code></pre>
          </div>
          <p>The 2 methods we need to override are <code class="highlighter-rouge">mousePressEvent</code> and
            <code class="highlighter-rouge">mouseReleaseEvent</code>:</p>
          <ul>
            <li>
              <p>In <code class="highlighter-rouge">mousePressEvent</code>, we add the pressed button to <code class="highlighter-rouge">mousePressedButtons</code> and
delegate the processing part to a method called <code class="highlighter-rouge">processKey</code></p>
            </li>
            <li>
              <p>In <code class="highlighter-rouge">mouseReleaseEvent</code>, we remove the current activated button from
                <code class="highlighter-rouge">mousePressedButtons</code></p>
            </li>
            <li>
              <p>We often want our mouse chords to be processed with keyboard modifiers, so
                <code class="highlighter-rouge">processKey</code> would take currently pressed keyboard modifiers and mouse
buttons as its arguments.</p>
            </li>
            <li>
              <p>A double-click event doesn’t generate the corresponding mouse press event,
so you need to override it to manually add the pressed button to
                <code class="highlighter-rouge">mousePressedButtons</code></p>
            </li>
            <li>
              <p><strong>Notes</strong>:</p>
              <ul>
                <li>We usually want the widget itself furthers processing the mouse chords
(such as single click to move cursor to a different position, double click
to select word, triple click to select line), so we call
                  <code class="highlighter-rouge">super().mousePressEvent(event)</code> and <code class="highlighter-rouge">super().mouseReleaseEvent(event)</code> at
the end of the 2 event handlers.</li>
                <li>To correctly catch right click events, context menu needs to be disabled,
see the <em>Disabling right-click context menu</em> part.</li>
                <li>Double-click is a legitimate mouse press event and it does not generate a
mouse press event, so usually everything handled in mouse press event
needs to be handled in double-click event too.</li>
                <li>The click-double_click events generate a mouse release event when the
second button is released.  Sometimes it might interrupt the handler, so
this mouse release event needs to be checked and handle properly.</li>
              </ul>
            </li>
          </ul>
          <p>Here is how the code looks like:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">def</span> <span class="nf">SomeWidget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do something</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c">#</span>
    <span class="c"># Mouse chord catching</span>
    <span class="c">#</span>

    <span class="k">def</span> <span class="nf">isOneMouseButtonAlreadyPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Determine if a mouse button has already been pressed and not yet
        released.  This function is useful when handling 2-button press
        event.
        """</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">getMousePressedButtons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">"""Get currently pressed mouse buttons in correct order."""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span> <span class="o">+</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span>

    <span class="k">def</span> <span class="nf">mouseDoubleClickEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">"""Handle all double click events."""</span>
        <span class="c"># TODO: Define away to handle double click events</span>

        <span class="c"># Double click means the clicked button is still pressed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">())</span>

        <span class="c">#</span>
        <span class="c"># If number of pressed buttons is more than 1, it's not an usual</span>
        <span class="c"># double click event -&gt; needed to treat like single click as well</span>
        <span class="c">#</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">processKeyCombination</span><span class="p">(</span><span class="n">mods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pressedMods</span><span class="p">,</span>
                                       <span class="n">mouse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mouseDoubleClickEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">"""Handling all kinds of mouse press events."""</span>

        <span class="n">pressedButtons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMousePressedButtons</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processKeyCombination</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                   <span class="n">mods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pressedMods</span><span class="p">,</span>
                                   <span class="n">mouse</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mouseReleaseEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">"""Handling mouse release event by unregistering the pressed
        button."""</span>
        <span class="c">#</span>
        <span class="c"># Strange case: Left-Left-Middle</span>
        <span class="c"># * Expected: select word, then cut</span>
        <span class="c"># * Real: select word, cut, then paste right after Middle is</span>
        <span class="c">#   released:</span>
        <span class="c">#</span>
        <span class="c"># Cause: the Middle release event is further processed by default</span>
        <span class="c"># event handler</span>
        <span class="c">#</span>
        <span class="c"># Solution: only delegate the event to super class when number of</span>
        <span class="c"># pressed buttons before the release event is emited is 1</span>
        <span class="c">#</span>

        <span class="n">nButtonsBefore</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mousePressedButtons</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">())</span>

        <span class="c"># Disable default "middle-click to paste" if necessary</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMousePressedButtons</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> \
           <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MidButton</span> \
           <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">midClickXPaste</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Solution to strange case mentioned above</span>
        <span class="k">if</span> <span class="n">nButtonsBefore</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">mouseReleaseEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</code></pre>
          </div>
          <p>See <a href="https://github.com/cmpitg/blutkit">Blutkit</a>’s implementation of
            <a href="https://github.com/cmpitg/blutkit/blob/master/blutkit/gui/textedit.py">TextEdit</a>
            for more info about real-world use.</p>
          <h3 id="tool-button">Tool button</h3>
          <p>This example create a <code class="highlighter-rouge">QToolButton</code> displaying an image from a pixmap, setting its tooltip action and assigning a shortcut.</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="nd">@slot</span>
<span class="k">def</span> <span class="nf">quitAction</span><span class="p">():</span>
    <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="nb">exit</span><span class="p">()</span>


<span class="n">quitPixmap</span> <span class="o">=</span> <span class="p">[]</span>             <span class="c"># A pixmap</span>

<span class="n">quitButton</span> <span class="o">=</span> <span class="n">QToolButton</span><span class="p">()</span>
<span class="n">quitAction</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="n">quitPixmap</span><span class="p">,</span> <span class="s">"Quit (Ctrl+X)"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">quitAction</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="p">(</span><span class="s">"Ctrl+X"</span><span class="p">))</span>
<span class="n">quitAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">quitApplication</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">setDefaultAction</span><span class="p">(</span><span class="n">quitAction</span><span class="p">)</span>
</code></pre>
          </div>
          <h3 id="icon">Icon</h3>
          <h4 id="creating-an-icon">Creating an icon</h4>
          <p>Icons are managed by the <code class="highlighter-rouge">QIcon</code> widget.  An icon could be created from:</p>
          <ul>
            <li>a pixmap,</li>
            <li>an image file,</li>
            <li>or another icon (very fast).</li>
          </ul>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">aPixMap</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">imagePath</span> <span class="o">=</span> <span class="s">"/path/to/your/image"</span>

<span class="n">icon1</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">aPixMap</span><span class="p">)</span>
<span class="n">icon2</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">imagePath</span><span class="p">)</span>
<span class="n">icon3</span> <span class="o">=</span> <span class="n">QIcon</span><span class="p">(</span><span class="n">icon1</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="setting-icon-for-a-window">Setting icon for a window</h4>
          <p>This idiom is usually used to set icon for your top-level window</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">aWindow</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">anIcon</span><span class="p">)</span>
</code></pre>
          </div>
          <h3 id="menu">Menu</h3>
          <p>Menus are managed by the <code class="highlighter-rouge">QMenu</code> class, menu bars are managed by the <code class="highlighter-rouge">QMenuBar</code> class.</p>
          <ul>
            <li>
              <p>A <em>menu bar</em> contain one or more <em>menus</em>.</p>
            </li>
            <li>
              <p>Each <em>menu</em> contains one or more <em>actions</em> (managed by <code class="highlighter-rouge">QAction</code>) or <em>submenus</em> (which are simple <em>menus</em> managed by <code class="highlighter-rouge">QMenu</code>).</p>
            </li>
          </ul>
          <h4 id="creating-a-menu">Creating a menu</h4>
          <p>A menu should be created with its parent.</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">topMenu1</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="n">mainWindow</span><span class="p">)</span>
<span class="n">topMenu2</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="s">"This is the title of the menu"</span><span class="p">,</span> <span class="n">mainWindow</span><span class="p">)</span>
</code></pre>
          </div>
          <h5 id="adding-actions">Adding actions</h5>
          <p>There are several ways to add actions into a menu:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">gotoDirAction</span> <span class="o">=</span> <span class="n">QAction</span><span class="p">(</span><span class="s">"&amp;Go to dir"</span><span class="p">,</span> <span class="n">menu</span><span class="p">)</span>
<span class="n">gotoDirAction</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">gotoDir</span><span class="p">)</span>
<span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">gotoDirAction</span><span class="p">)</span>

<span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s">"&amp;New file"</span><span class="p">)</span>
<span class="n">actions</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">actions</span><span class="p">()</span>
<span class="n">actions</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">newFile</span><span class="p">)</span>

<span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s">"&amp;Save file"</span><span class="p">)</span>
<span class="n">action</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">saveFile</span><span class="p">)</span>

<span class="n">actionWithIcon</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">anIcon</span><span class="p">,</span> <span class="s">"&amp;Open file"</span><span class="p">)</span>
<span class="n">actionWithIcon</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">openFile</span><span class="p">)</span>
</code></pre>
          </div>
          <p>There are more ways to add actions to a menu.  Visit <a href="http://srinikom.github.io/pyside-docs/PySide/QtGui/QMenu.html#PySide.QtGui.PySide.QtGui.QMenu.addAction">PySide documentation</a> or <a href="http://doc-snapshot.qt-project.org/qt5-stable/qtwidgets/qmenu.html">Qt documentation</a> for further info.</p>
          <p>My most recommended way of adding an action is the last example.</p>
          <h5 id="adding-submenu">Adding submenu</h5>
          <p>Submenus <em>are</em> menus, so adding submenus is pretty straightforward:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">systemMenu</span><span class="p">)</span>

<span class="n">appMenu</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s">"Applications"</span><span class="p">)</span>
<span class="c"># Do something with appMenu</span>

<span class="n">gameMenu</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="n">gameIcon</span><span class="p">,</span> <span class="s">"Games"</span><span class="p">)</span>
<span class="c"># Do something with gameMenu</span>
</code></pre>
          </div>
          <h5 id="showingexecuting-a-menu">Showing/executing a menu</h5>
          <p>Showing/executing a menu means making the menu visible on the screen.  Usually, the visibility of the menu associates with the current position of the cursor/mouse. Thus,</p>
          <ul>
            <li>
              <p>if the menu is showed at the current mouse position:</p>
              <div class="language-python highlighter-rouge">
                <pre class="highlight"><code><span class="n">menu</span><span class="o">.</span><span class="k">exec</span><span class="p">(</span><span class="n">QCursor</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
</code></pre>
              </div>
              <p>or using a <code class="highlighter-rouge">QMouseEvent e</code>:</p>
              <div class="language-python highlighter-rouge">
                <pre class="highlight"><code><span class="n">menu</span><span class="o">.</span><span class="k">exec</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">globalPos</span><span class="p">())</span>
</code></pre>
              </div>
            </li>
            <li>
              <p>if the menu is aligned to a widget:</p>
              <div class="language-python highlighter-rouge">
                <pre class="highlight"><code><span class="n">menu</span><span class="o">.</span><span class="k">exec</span><span class="p">(</span><span class="n">aWidget</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">QPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</code></pre>
              </div>
            </li>
          </ul>
          <p>Although you may specify directly the list of actions the menu shows using <code class="highlighter-rouge">exec</code>, it’s not a recommended way.</p>
          <p>There are cases when you want the menu to be displayed so that an action <code class="highlighter-rouge">someAction</code> will be at the specified global position <code class="highlighter-rouge">pos</code>.  Use <code class="highlighter-rouge">popup</code> then:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="n">menu</span><span class="o">.</span><span class="n">popup</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">someAction</span><span class="p">)</span>
</code></pre>
          </div>
          <h5 id="tearing-off-the-menu">Tearing-off the menu</h5>
          <p>Tearing off a menu means “extracting” the menu into a standalone widget and vice-versa.  Qt directly supports tear-off menu with <code class="highlighter-rouge">menu.setTearOffEnable(trueOrFalse)</code>.  The property could be accessed via <code class="highlighter-rouge">menu.isTearOffEnabled()</code>.</p>
          <h3 id="text-edit-widget">Text Edit widget</h3>
          <ul>
            <li>
              <p>All text manipulation is done using a <code class="highlighter-rouge">QTextCursor</code>, received by
                <code class="highlighter-rouge">textEdit.textCursor()</code>.  After done, the text cursor needs to be re-set to
replace current cursor using <code class="highlighter-rouge">textEdit.setTextCursor(cursor)</code>:</p>
              <p><code class="highlighter-rouge">python
   cursor = textEdit.textCursor()
   # Do something with cursor
   textEdit.setTextCursor(cursor)
  </code></p>
            </li>
          </ul>
          <h4 id="moving">Moving</h4>
          <h4 id="selecting">Selecting</h4>
          <p>Selecting a block of text is done by moving the text cursor to the beginning
of the block, then move it to the end and keep its anchor.  E.g. The
            <code class="highlighter-rouge">QTextEdit</code>’s <code class="highlighter-rouge">selectLine</code> method could be implemented like so:</p>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">QTextEdit</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">selectLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Select the current line."""</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">movePosition</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">StartOfBlock</span><span class="p">)</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">movePosition</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">EndOfBlock</span><span class="p">,</span> <span class="n">QTextCursor</span><span class="o">.</span><span class="n">KeepAnchor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTextCursor</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="selecting-current-line">Selecting current line</h4>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTextEdit</span><span class="p">(</span><span class="n">QTextEdit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">selectLine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Select the current line."""</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">LineUnderCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTextCursor</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>
          </div>
          <h4 id="selecting-current-word">Selecting current word</h4>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTextEdit</span><span class="p">(</span><span class="n">QTextEdit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">selectWord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Select the word line."""</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">WordUnderCursor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTextCursor</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>
          </div>
          <h3 id="clear-current-selection">Clear current selection</h3>
          <div class="language-python highlighter-rouge">
            <pre class="highlight"><code><span class="k">class</span> <span class="nc">MyTextEdit</span><span class="p">(</span><span class="n">QTextEdit</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">clearSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Clear the current selection."""</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTextCursor</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
</code></pre>
          </div>
        </div>
        <hr class="fin" />
      </article>
      <footer>
        <div id="copyright-footer">© Ha-Duong Nguyen 2016.
    Unless clearly stated, all contents are released under the terms of
    the <a href="https://creativecommons.org/licenses/by-sa/4.0/legalcode">CC
    BY-SA v4.0 license</a>.</div>
      </footer>
      <div id="fine-print">
        <p>
        </p>
      </div>
    </section>
  </body>
</html>